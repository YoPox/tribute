<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>tribute</title>
    <script src="bower_components/pixi.js/dist/pixi.js" charset="utf-8"></script>
    <script src="perlin.js" charset="utf-8"></script>
    <script src="gen.js" charset="utf-8"></script>
    <script src="util.js" charset="utf-8"></script>

    <style media="screen">
        html {
            height: 100%;
            overflow-y: hidden;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            margin: 0;
        }

        canvas {
            image-rendering: pixelated;
        }
    </style>

</head>

<body>

</body>

<script type="text/javascript">
    var width = 1280,
        height = 720;

    var renderer = new PIXI.autoDetectRenderer(1280, 720, {
        antialias: false,
        transparent: false,
        resolution: 1
    });
    document.body.appendChild(renderer.view);

    var stage = new PIXI.Container();

    PIXI.loader
        .add('assets/tileset.json')
        .load(onAssetsLoaded);

    function onAssetsLoaded() {

        var tiles = PIXI.loader.resources["assets/tileset.json"].textures;
        var map = Gen.generate(width / 8, height / 8, Math.random()); // Numbers
        var tilemap = [] // Contains each tile

        var graphics = new PIXI.Graphics();

        let seuil = 100;

        for (var i = 0; i < map.length; i++) {
            for (var j = 0; j < map[i].length; j++) {
                let color1, color2, color3;
                if (map[i][j] < seuil) {
                    color1 = "0D";
                    color2 = "47";
                    color3 = "A1";
                } else {
                    color1 = Util.toHex(Math.floor(((225 - map[i][j]) / 1.25 + 51) / 2));
                    color2 = Util.toHex(Math.floor(((225 - map[i][j]) / 1.25 + 105) / 2));
                    color3 = Util.toHex(Math.floor(((225 - map[i][j]) / 1.25 + 30) / 2));
                }
                graphics.beginFill("0x" + color1 + color2 + color3);
                graphics.drawRect(j * 8, i * 8, 8, 8);
                graphics.endFill();
            }
        }

        // for (var i = 0; i < map.length; i++) {
        //     for (var j = 0; j < map[i].length; j++) {
        //         tilemap.push(new PIXI.Sprite(tiles[map[i][j]]));
        //         let n = tilemap.length - 1;
        //         tilemap[n].x = 16 * j;
        //         tilemap[n].y = 16 * i;
        //         stage.addChild(tilemap[n]);
        //     }
        // }

        stage.addChild(graphics);
        renderer.render(stage);
    }
</script>

</html>
